<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Steven Garrity and Richard Palmer" />

<meta name="date" content="2019-10-26" />

<title>FinalReport</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="CLT_2.html">CLT Practice</a>
</li>
<li>
  <a href="Craft_Beer_Rmarkdown.html">Craft Beer Rmarkdown</a>
</li>
<li>
  <a href="craft_beer_case_study.html">Craft Beer R Shiny Apps</a>
</li>
<li>
  <a href="r_shiny_apps.html">R Shiny Apps</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">FinalReport</h1>
<h4 class="author">Steven Garrity and Richard Palmer</h4>
<h4 class="date">26 October 2019</h4>

</div>


<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(usmap)</code></pre>
<pre class="r"><code># import raw data
beers_raw &lt;- read.csv(&#39;Beers.csv&#39;) %&gt;% rename(Brew_ID = Brewery_id, Beer_name = Name)
breweries_raw &lt;- read.csv(&#39;Breweries.csv&#39;) %&gt;% rename(Brewery_name = Name)

# join on Brewery ID and sort the result by Beer ID.
merged &lt;- inner_join(beers_raw, breweries_raw,by=&#39;Brew_ID&#39;) %&gt;% arrange(Beer_ID)

# shared place to create data for various maps later on.
states &lt;- map_data(&quot;state&quot;)
states_and_dc &lt;- tibble(state = state.name) %&gt;%
   bind_cols(tibble(abbr = state.abb)) %&gt;% 
   bind_rows(tibble(state = &quot;District of Columbia&quot;, abb = &quot;DC&quot;))</code></pre>
<div id="prepared-for" class="section level1">
<h1>Prepared for</h1>
<p>Prepared for CEO and CFO of Budweiser, a subsidiary of Anheuser-Busch.</p>
<p>Case Study 1 project for DS6306 Section 408 Fall 2019 Dr. Bivin Sadler</p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The purpose of this project is to study a dataset of 2410 beers produced by 558 breweries in the United States. We have data on the style, ABV (alcohol by volume) and IBU (international bitterness units) of each beer, and we have the city and state for each brewery. The goal is to answer some specific questions about the data and to look for relationships or inferences which may be of interest to a hypothetical sponsor, Budweiser.</p>
</div>
<div id="question-1-how-many-breweries-in-each-state" class="section level1">
<h1>Question 1: How many breweries in each state?</h1>
</div>
<div id="map-the-number-of-breweries-per-state" class="section level1">
<h1>Map the number of breweries per state:</h1>
<pre class="r"><code>breweries_by_state &lt;- breweries_raw %&gt;%  group_by(State) %&gt;% summarize(count = n())

# library(maps)
states &lt;- map_data(&quot;state&quot;)

# add DC to embedded &quot;state&quot; dataset:
states_and_dc &lt;- tibble(state = state.name) %&gt;%
   bind_cols(tibble(abbr = state.abb)) %&gt;% 
   bind_rows(tibble(state = &quot;District of Columbia&quot;, abb = &quot;DC&quot;))

# found an empty white space in the state abbreviation data. Remove it first:
breweries_by_state$State &lt;- str_trim(breweries_by_state$State, &quot;left&quot;)

# need to match the column name.
colnames(breweries_by_state)[1] = &quot;abbr&quot;

# This appears to be necessary, but I&#39;m not 100% certain why:
breweries_by_state$abbr &lt;- as.character(breweries_by_state$abbr)

# merge three dataframes: brewery count per state, state names and abbreviations, and state population data
breweries_by_state_temp &lt;- merge(breweries_by_state, states_and_dc, by=&quot;abbr&quot;)
breweries_by_state_tomap &lt;- merge(breweries_by_state_temp, statepop, by=&quot;abbr&quot;)
breweries_by_state_tomap$perCapita &lt;- breweries_by_state_tomap$count/(breweries_by_state_tomap$pop_2015/1000000)</code></pre>
</div>
<div id="number-of-breweries-by-state" class="section level1">
<h1>Number of breweries by state:</h1>
<pre class="r"><code># library(usmap)
# library(ggthemes)

### Map the total number of breweries in each state:
plot_usmap(regions = c(&quot;states&quot;), data = breweries_by_state_tomap,
  values = &quot;count&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) +
  scale_fill_continuous(name = &quot;n&quot;, low=&quot;white&quot;, high=&quot;#c8102e&quot;) +
  theme(legend.position=&quot;right&quot;) +
  labs(title = &#39;Number of Breweries in each state&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="breweries-per-capita-in-each-state" class="section level1">
<h1>Breweries per Capita in each state:</h1>
<pre class="r"><code>### Map the number of breweries per capita in each state:
plot_usmap(regions = c(&quot;states&quot;), data = breweries_by_state_tomap,
  values = &quot;perCapita&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) +
  scale_fill_continuous(name = &quot;n*&quot;, low=&quot;white&quot;, high=&quot;#13294b&quot;) +
  theme(legend.position=&quot;right&quot;, 
        plot.caption = element_text(color=&quot;navyblue&quot;, size = 8, hjust=1)) +
  labs(title = &#39;Breweries per Capita*&#39;, caption = &quot;*per 1M people&quot;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="supplemental-bar-charts-of-breweries-per-state-and-breweries-per-capita-by-state" class="section level1">
<h1>Supplemental bar charts of breweries per state and breweries per capita by state:</h1>
<pre class="r"><code>#bar charts
library(grid)
p1 &lt;- breweries_by_state_tomap %&gt;% ggplot(aes(x=reorder(abbr, -count), y=count)) +
  geom_col(fill=&quot;#c8102e&quot;) +
  labs(title = &quot;Breweries per State&quot;, y=&quot;Number of Breweries&quot;, x=&quot;&quot;)

p2 &lt;- breweries_by_state_tomap %&gt;% ggplot(aes(x=reorder(abbr, -perCapita), y=perCapita)) +
  geom_col(fill=&quot;#13294b&quot;) +
  labs(title = &quot;Breweries per Capita* by State&quot;, 
       y=&quot;Number of Breweries&quot;, x=&quot;&quot;, caption=&quot;*per 1M people&quot;)

grid.newpage()
grid.draw(rbind(ggplotGrob(p1), ggplotGrob(p2), size=&quot;last&quot;))</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="question-2" class="section level1">
<h1>Question 2</h1>
<p>As a check on importing and merging data, print the first six and last six observations.</p>
<pre class="r"><code>cat (&quot;The first six observations, after sorting by beer ID.&quot;)</code></pre>
<pre><code>## The first six observations, after sorting by beer ID.</code></pre>
<pre class="r"><code>head(merged,6)</code></pre>
<pre><code>##                  Beer_name Beer_ID   ABV IBU Brew_ID
## 1          Dale&#39;s Pale Ale       1 0.065  65     167
## 2        Gordon Ale (2009)       4 0.087  85     167
## 3                 Old Chub       5 0.080  35     167
## 4       GUBNA Imperial IPA       6 0.099 100     167
## 5 Mama&#39;s Little Yella Pils       7 0.053  35     167
## 6  Ten Fidy Imperial Stout       8 0.099  98     167
##                            Style Ounces        Brewery_name     City State
## 1        American Pale Ale (APA)     12 Oskar Blues Brewery Longmont    CO
## 2 American Double / Imperial IPA     12 Oskar Blues Brewery Longmont    CO
## 3                   Scottish Ale     12 Oskar Blues Brewery Longmont    CO
## 4 American Double / Imperial IPA     12 Oskar Blues Brewery Longmont    CO
## 5                 Czech Pilsener     12 Oskar Blues Brewery Longmont    CO
## 6         Russian Imperial Stout     12 Oskar Blues Brewery Longmont    CO</code></pre>
<pre class="r"><code>cat (&quot;The last six observations, after sorting by beer ID.&quot;)</code></pre>
<pre><code>## The last six observations, after sorting by beer ID.</code></pre>
<pre class="r"><code>tail(merged,6)</code></pre>
<pre><code>##          Beer_name Beer_ID   ABV IBU Brew_ID
## 2405   Parapet ESB    2687 0.056  47       1
## 2406    Stronghold    2688 0.060  25       1
## 2407       Pumpion    2689 0.060  38       1
## 2408    Wall&#39;s End    2690 0.048  19       1
## 2409 Maggie&#39;s Leap    2691 0.049  26       1
## 2410  Get Together    2692 0.045  50       1
##                                    Style Ounces       Brewery_name
## 2405 Extra Special / Strong Bitter (ESB)     16 NorthGate Brewing 
## 2406                     American Porter     16 NorthGate Brewing 
## 2407                         Pumpkin Ale     16 NorthGate Brewing 
## 2408                   English Brown Ale     16 NorthGate Brewing 
## 2409                  Milk / Sweet Stout     16 NorthGate Brewing 
## 2410                        American IPA     16 NorthGate Brewing 
##             City State
## 2405 Minneapolis    MN
## 2406 Minneapolis    MN
## 2407 Minneapolis    MN
## 2408 Minneapolis    MN
## 2409 Minneapolis    MN
## 2410 Minneapolis    MN</code></pre>
</div>
<div id="question-3-address-the-missing-values-in-each-column." class="section level1">
<h1>Question 3: Address the missing values in each column.</h1>
</div>
<div id="data-exploration" class="section level1">
<h1>Data Exploration:</h1>
<p>Determine Which Variables Have Missing Values and How Many</p>
<pre><code>## [1] &quot;Beer_name&quot; &quot;0&quot;        
## [1] &quot;Beer_ID&quot; &quot;0&quot;      
## [1] &quot;ABV&quot; &quot;62&quot; 
## [1] &quot;IBU&quot;  &quot;1005&quot;
## [1] &quot;Brew_ID&quot; &quot;0&quot;      
## [1] &quot;Style&quot; &quot;0&quot;    
## [1] &quot;Ounces&quot; &quot;0&quot;     
## [1] &quot;Brewery_name&quot; &quot;0&quot;           
## [1] &quot;City&quot; &quot;0&quot;   
## [1] &quot;State&quot; &quot;0&quot;</code></pre>
<pre><code>## [1] 1005</code></pre>
<pre><code>## [1] 1005</code></pre>
</div>
<div id="fill-abv-missing-values" class="section level1">
<h1>Fill ABV missing values:</h1>
<p>For filled each missing ABV value with the median ABV value for that Beer Style. For example, if the missing ABV was for an IPA, then we filled the value with the median ABV value for IPAs.<br />
Filled ABV values are placed in the merged data frame as merged$ABVfill.</p>
<pre><code>## Warning: Removed 62 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre><code>##  [1]   55   56   57   58   59   62  111  126  166  170  175  196  223  289
## [15]  290  291  292  293  330  332  345  348  460  513  530  560  570  575
## [29]  641  642  643  644  708  712  731  791  821  857  858  924 1104 1288
## [43] 1468 1494 1496 1527 1533 1539 1683 1934 2045 2064 2066 2086 2102 2103
## [57] 2193 2208 2209 2210 2211 2316</code></pre>
<pre><code>## integer(0)</code></pre>
</div>
<div id="fill-ibu-missing-values" class="section level1">
<h1>Fill IBU missing values:</h1>
<p>We used a regression tree with ABV and Beer Style as predictors to fill missing IBU values. Filled IBU values are placed in the merged data frame as merged$IBUfill. <img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre><code>## [1] 60200.85</code></pre>
<pre><code>## [1] 171.5124</code></pre>
<pre><code>## [1] 13.09627</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
</div>
<div id="question-4" class="section level1">
<h1>Question 4</h1>
<p>Compute the Median alcohol content for all the beers in each state.</p>
<pre class="r"><code># drop any observations without valid ABV values, group by state, and compute the median
abv_df &lt;- merged %&gt;% group_by(State) %&gt;% 
  summarize(median_abv = median(ABV,na.rm=TRUE),median_abvfill = median(ABVfill)) 

# order by median ABV
abv_df$State &lt;- factor(abv_df$State,level=abv_df$State[order(abv_df$median_abvfill,decreasing=TRUE)])</code></pre>
<p>Here are the original data, with missing observations dropped:</p>
<pre class="r"><code># ..and plot
abv_df %&gt;% ggplot(aes(x=State,y=median_abv)) + 
  geom_col(color=&quot;#13294b&quot;,fill=&quot;#C8102E&quot;) + 
  theme(aspect.ratio = 0.2,axis.text=element_text(size=4)) +
  ylab(&#39;Median ABV&#39;) + 
  ggtitle(&#39;Median ABV by state (missing values dropped)&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>and here is the same plot, with missing values infilled. Note that the ordering of states is the same for these two graphs.</p>
<pre class="r"><code>abv_df %&gt;% ggplot(aes(x=State,y=median_abvfill)) + 
  geom_col(color=&quot;#13294b&quot;,fill=&quot;#C8102E&quot;) + 
  theme(aspect.ratio = 0.2,axis.text=element_text(size=4)) +
  ylab(&#39;Median ABV&#39;) + 
  ggtitle(&#39;Median ABV by state (missing values infilled)&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Here is the same data, with each state colored by the its median ABV value.</p>
<pre class="r"><code># change up a bit to make a map
abv_df$State &lt;- str_trim(abv_df$State, &quot;left&quot;)

colnames(abv_df)[1] = &quot;abbr&quot;
abv_df$abbr &lt;- as.character(abv_df$abbr)

abv_by_state_tomap &lt;- merge(abv_df, states_and_dc, by=&quot;abbr&quot;)

plot_usmap(regions = c(&quot;states&quot;), data = abv_by_state_tomap,
  values = &quot;median_abvfill&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) +
  scale_fill_continuous(name = &quot;ABV&quot;, low=&quot;ivory&quot;, high=&quot;#c8102e&quot;) +
  theme(legend.position=&quot;right&quot;) +
  labs(title = &#39;Median ABV of beers by state, infilled data&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Compute the median bitterness unit for all the beers in each state</p>
<pre class="r"><code># drop any obsvervations without valid IBU values, roup by state, and compute the median
ibu_df &lt;- merged %&gt;% group_by(State) %&gt;% 
  summarize(median_ibu = median(IBU,na.rm=TRUE),median_ibufill=median(IBUfill)) 

# order by median IBU
ibu_df$State &lt;- factor(ibu_df$State,level=ibu_df$State[order(ibu_df$median_ibufill,decreasing=TRUE)])</code></pre>
<p>Here are the original data, with missing observations dropped:</p>
<pre class="r"><code># ..and plot
ibu_df %&gt;% ggplot(aes(x=State,y=median_ibu)) +
  geom_col(color=&quot;#13294b&quot;,fill=&quot;#C8102E&quot;) + 
  theme(aspect.ratio = 0.2,axis.text=element_text(size=4)) +
  ylab(&#39;Median IBU&#39;) + 
  ggtitle(&#39;Median IBU by state (missing values dropped)&#39;)</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (position_stack).</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>and here is the same plot, with missing values infilled. Note that the ordering of states is the same for these two graphs.</p>
<pre class="r"><code>ibu_df %&gt;% ggplot(aes(x=State,y=median_ibufill)) +
  geom_col(color=&quot;#13294b&quot;,fill=&quot;#C8102E&quot;) + 
  theme(aspect.ratio = 0.2,axis.text=element_text(size=4)) +
  ylab(&#39;Median IBU&#39;) + 
  ggtitle(&#39;Median IBU by state (missing values infilled)&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Here is the same data, with each state colored by the its median IBU value.</p>
<pre class="r"><code># change a bit to make a map
ibu_df$State &lt;- str_trim(ibu_df$State, &quot;left&quot;)

colnames(ibu_df)[1] = &quot;abbr&quot;
ibu_df$abbr &lt;- as.character(ibu_df$abbr)

ibu_by_state_tomap &lt;- merge(ibu_df, states_and_dc, by=&quot;abbr&quot;)

plot_usmap(regions = c(&quot;states&quot;), data = ibu_by_state_tomap,
  values = &quot;median_ibufill&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) +
  scale_fill_continuous(name = &quot;ABV&quot;, low=&quot;ivory&quot;, high=&quot;#13294b&quot;) +
  theme(legend.position=&quot;right&quot;) +
  labs(title = &#39;Median ABV of beers by state&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="question-5---which-state-has-the-maximum-abv-and-ibu" class="section level1">
<h1>Question 5 - Which state has the maximum ABV and IBU?</h1>
</div>
<div id="max-abv" class="section level1">
<h1>Max ABV</h1>
<p>Colorado has the maximum ABV at 12.8%</p>
<pre class="r"><code>#run twice: 1) with missing values, 2) without missing values

maxABVnofill &lt;- merged %&gt;% 
  group_by(State) %&gt;% 
  summarize(maxABV = max(ABV, na.rm = TRUE)) %&gt;% 
  arrange(desc(maxABV))

maxABVfill &lt;- merged %&gt;% 
  group_by(State) %&gt;% 
  summarize(maxABV = max(ABVfill)) %&gt;% 
  arrange(desc(maxABV))

# no difference in the top 10 states when using ABV vs ABVfill

#########################################
# try a diverging bar chart
theme_set(theme_bw())  

# Data Prep for ABV
maxABVfill$maxABV_z &lt;- round((maxABVfill$maxABV - mean(maxABVfill$maxABV))/
                               sd(maxABVfill$maxABV), 2)  # compute normalized mpg
maxABVfill$maxABV_type &lt;- ifelse(maxABVfill$maxABV_z &lt; 0, &quot;below&quot;, &quot;above&quot;)  # above / below avg flag
maxABVfill &lt;- maxABVfill[order(maxABVfill$maxABV_z), ]  # sort
maxABVfill$State &lt;- factor(maxABVfill$State, levels = maxABVfill$State)  # convert to factor to retain sorted order in plot.</code></pre>
</div>
<div id="diverging-barchart-for-abv" class="section level1">
<h1>Diverging Barchart for ABV:</h1>
<pre class="r"><code>ggplot(maxABVfill, aes(x=State, y=maxABV_z, label=maxABV_type)) + 
  geom_bar(stat=&#39;identity&#39;, aes(fill=maxABV_type), width=.5)  +
  scale_fill_manual(name=&quot;Maximum ABV&quot;, 
                    labels = c(&quot;Above Average&quot;, &quot;Below Average&quot;), 
                    values = c(&quot;above&quot;=&quot;#13294b&quot;, &quot;below&quot;=&quot;#b1b3b3&quot;)) + 
  labs(title= &quot;Normalized maximum ABV by State&quot;, y=&quot;maximum ABV z-score&quot;, x=&quot;&quot;) + 
  coord_flip()</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="zoom-in-on-top-5-states-with-the-highest-abv" class="section level1">
<h1>Zoom in on top 5 states with the highest ABV:</h1>
<pre class="r"><code>maxABVfill %&gt;% filter(State == &quot; CO&quot; | State == &quot; KY&quot; | State == &quot; IN&quot; | State == &quot; NY&quot; | State == &quot; WI&quot;) %&gt;% ggplot(aes(x=State, y=maxABV)) + 
  geom_bar(stat=&#39;identity&#39;, fill = &quot;#13294b&quot;, width=.9)  + 
  coord_flip() +
  geom_text(aes(label=maxABV), position=position_dodge(width=0.9), hjust=+1.25, col=&quot;white&quot;) +
  labs(title= &quot;States with the Highest ABV&quot;, x=&quot;&quot;, y=&quot;ABV&quot;) </code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
<div id="which-state-has-the-most-bitter-beer" class="section level1">
<h1>Which state has the most bitter beer?</h1>
<p>Oregon has the maximum IBU at 138</p>
<pre class="r"><code>#run twice: 1) with missing values, 2) without missing values
maxIBUfill &lt;- merged %&gt;% 
  group_by(State) %&gt;% 
  summarize(maxIBU = max(IBUfill)) %&gt;% 
  arrange(desc(maxIBU))

# no difference in the top 10 states when using ABV vs ABVfill

#########################################
# try a diverging bar chart
theme_set(theme_bw())  

# Data Prep for ABV
maxIBUfill$maxIBU_z &lt;- round((maxIBUfill$maxIBU - mean(maxIBUfill$maxIBU))/
                               sd(maxIBUfill$maxIBU), 2)  # compute normalized mpg
maxIBUfill$maxIBU_type &lt;- ifelse(maxIBUfill$maxIBU_z &lt; 0, &quot;below&quot;, &quot;above&quot;)  # above / below avg flag
maxIBUfill &lt;- maxIBUfill[order(maxIBUfill$maxIBU_z), ]  # sort
maxIBUfill$State &lt;- factor(maxIBUfill$State, levels = maxIBUfill$State)  # convert to factor to retain sorted order in plot.</code></pre>
</div>
<div id="diverging-barchart-for-abv-1" class="section level1">
<h1>Diverging Barchart for ABV:</h1>
<pre class="r"><code>ggplot(maxIBUfill, aes(x=State, y=maxIBU_z, label=maxIBU_type)) + 
  geom_bar(stat=&#39;identity&#39;, aes(fill=maxIBU_type), width=.5)  +
  scale_fill_manual(name=&quot;Maximum IBU&quot;, 
                    labels = c(&quot;Above Average&quot;, &quot;Below Average&quot;), 
                    values = c(&quot;above&quot;=&quot;#C8102E&quot;, &quot;below&quot;=&quot;#b1b3b3&quot;)) + 
  labs(title= &quot;Normalized maximum IBU by State&quot;, y=&quot;maximum IBU z-score&quot;, x=&quot;&quot;) + 
  coord_flip()</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="zoom-in-on-top-5-states-with-the-highest-ibu" class="section level1">
<h1>Zoom in on top 5 states with the highest IBU:</h1>
<pre class="r"><code>maxIBUfill %&gt;% filter(State == &quot; OR&quot; | State == &quot; VA&quot; | State == &quot; MA&quot; | State == &quot; OH&quot; | State == &quot; VT&quot;) %&gt;% ggplot(aes(x=State, y=maxIBU)) + 
  geom_bar(stat=&#39;identity&#39;, fill = &quot;#C8102E&quot;, width=.9)  + 
  coord_flip() +
  geom_text(aes(label=maxIBU), position=position_dodge(width=0.9), hjust=+1.25, col=&quot;white&quot;) +
  labs(title= &quot;States with the Highest IBU&quot;, x=&quot;&quot;, y=&quot;IBU&quot;) </code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="in-case-we-want-to-map" class="section level1">
<h1>In case we want to map:</h1>
<pre class="r"><code># states_and_dc &lt;- tibble(state = state.name) %&gt;%
#    bind_cols(tibble(abbr = state.abb)) %&gt;% 
#    bind_rows(tibble(state = &quot;District of Columbia&quot;, abbr = &quot;DC&quot;))
# 
# maxABVfill$State &lt;- str_trim(maxABVfill$State, &quot;left&quot;)
# colnames(maxABVfill)[1] = &quot;abbr&quot;
# maxABVfill$abbr &lt;- as.character(maxABVfill$abbr)
# 
# maxabv_bystate_tomap &lt;- merge(maxABVfill, states_and_dc, by=&quot;abbr&quot;)
# maxabv_bystate_tomap$maxABVrank &lt;- c(seq(10,1),seq(40,1))
# 
# quants &lt;- as.numeric(quantile(maxabv_bystate_tomap$maxABV, c(.1,.2,.3,.4,.5,.6,.7,.8,.9,.99,1)))
# quant_labels &lt;- c(&quot;10th&quot;,&quot;20th&quot;,&quot;30th&quot;,&quot;40&quot;,&quot;50&quot;,&quot;60&quot;,&quot;70&quot;,&quot;80&quot;,&quot;90&quot;,&quot;99&quot;)

# maxabv_bystate_tomap$quant &lt;- maxabv_bystate_tomap$maxABV
# for (i in 1:length(quants))
# {
#   maxabv_bystate_tomap$quant[(maxabv_bystate_tomap$maxABV &gt; quants[i])] = quants[i]
# }
# 
# library(usmap)
# library(ggthemes)
# 
# plot_usmap(regions = c(&quot;states&quot;), data = maxabv_bystate_tomap,
#   values = &quot;quant&quot;, theme = theme_map(), labels = FALSE,
#   label_color = &quot;black&quot;) +
#   scale_fill_continuous(name = &quot;maximum ABV&quot;, low=&quot;ivory&quot;, high=&quot;red2&quot;) +
#   theme(legend.position=&quot;right&quot;) +
#   labs(title = &#39;max ABV quantiles&#39;)</code></pre>
</div>
<div id="question-6" class="section level1">
<h1>Question 6</h1>
<p>Comment on the summary statistics and distribution of the ABV variable.</p>
<pre class="r"><code>summary(merged$ABVfill)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00100 0.05000 0.05600 0.05972 0.06700 0.12800</code></pre>
<pre class="r"><code>sd(merged$ABVfill)</code></pre>
<pre><code>## [1] 0.01344674</code></pre>
<pre class="r"><code>summary(merged$ABV)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
## 0.00100 0.05000 0.05600 0.05977 0.06700 0.12800      62</code></pre>
<pre class="r"><code>sd(merged$ABV,na.rm=TRUE)</code></pre>
<pre><code>## [1] 0.01354173</code></pre>
<p>The mean is slightly higher than the median, which would indicate a right skewed distribution, one with a long tail of high values.</p>
<pre class="r"><code>merged %&gt;%
  ggplot(aes(x=ABVfill)) + geom_histogram(aes(y=..density..),bins=27) + 
  ggtitle(&#39;Histogram of ABV values (missing values infilled)&#39;) +
  geom_vline(aes(xintercept=median(ABVfill)),color=&#39;blue&#39;,linetype=&#39;dashed&#39;,size=1) +
  geom_text(mapping=aes(x=median(ABVfill),y=40,label=&quot;median&quot;),color=&quot;blue&quot;,angle=90,vjust=-0.4,show.legend=FALSE) +
  geom_vline(aes(xintercept=mean(ABVfill)), color=&#39;red&#39;,linetype=&#39;dotted&#39;,size=1) +
  geom_text(mapping=aes(x=mean(ABVfill),y=40,label=&quot;mean&quot;),color=&quot;red&quot;,angle=90,vjust=-0.4,show.legend=FALSE) +
  geom_density(alpha=.2,fill=&quot;#FF6666&quot;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>The histogram bears this out, as does a box plot</p>
<pre class="r"><code>merged %&gt;%
  ggplot(aes(x=&quot;&quot;,y=ABVfill)) +
  geom_boxplot() +
  xlab(&quot;&quot;) + ylab(&quot;&quot;) +
  ggtitle(&#39;ABV values&#39;) +
  #geom_hline(yintercept=0.07,color=&quot;blue&quot;,show.legend=FALSE) +
  #geom_text(mapping=aes(y=0.07,label=&quot;mean&quot;),color=&quot;blue&quot;,vjust=-1,show.legend = FALSE) +
  theme(aspect.ratio = 2.0) +
  coord_cartesian(ylim=c(0,0.15))</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>To investigate whether the ABV values are normally distributed, we do a Q-Q plot. This is a plot of the quantiles of the actual data against what would be expected from a normal distribution. If the data do follow a normal distribution, the plot would show a straight line. The more the plot deviates from a straight line, the less closely the data follow a normal distribution.</p>
<pre class="r"><code>merged %&gt;% 
  ggplot(aes(sample=ABVfill)) +
  stat_qq() + stat_qq_line() + 
  ggtitle(&#39;Quantile-Quantile plot of (infilled) ABV data&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>From the upward curve in this plot, we infer that the data are somewhat skewed. This confirms what the histogram shows. The apparent discontinuities at the ends of the curve are an indication that the ABV values have a few more extreme values than would be expected from a normal distribution. This confirms what was shown in the box plot.</p>
</div>
<div id="question-7---scatterplot-of-bitterness-versus-alcoholic-content." class="section level1">
<h1>Question 7 - Scatterplot of bitterness versus alcoholic content.</h1>
</div>
<div id="prepare-the-data" class="section level1">
<h1>Prepare the data:</h1>
</div>
<div id="fit-linear-model" class="section level1">
<h1>Fit linear model:</h1>
<pre><code>## 
## Call:
## lm(formula = merged$ABVfill ~ merged$IBUfill)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.047491 -0.005705 -0.001945  0.003699  0.073666 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    4.487e-02  4.113e-04  109.11   &lt;2e-16 ***
## merged$IBUfill 3.604e-04  8.606e-06   41.88   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.01023 on 2408 degrees of freedom
## Multiple R-squared:  0.4215, Adjusted R-squared:  0.4212 
## F-statistic:  1754 on 1 and 2408 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="scatterplots" class="section level1">
<h1>Scatterplots:</h1>
</div>
<div id="fit-linear-model-with-unfilled-data-only" class="section level1">
<h1>Fit linear model with unfilled data only:</h1>
<pre><code>## 
## Call:
## lm(formula = merged$ABV ~ merged$IBU)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.033288 -0.005946 -0.001595  0.004022  0.052006 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 4.493e-02  5.177e-04   86.79   &lt;2e-16 ***
## merged$IBU  3.508e-04  1.036e-05   33.86   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.01007 on 1403 degrees of freedom
##   (1005 observations deleted due to missingness)
## Multiple R-squared:  0.4497, Adjusted R-squared:  0.4493 
## F-statistic:  1147 on 1 and 1403 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="scatterplot-with-statistics" class="section level1">
<h1>Scatterplot with statistics:</h1>
<pre><code>## Warning: Removed 1005 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1005 rows containing missing values (geom_point).</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
</div>
<div id="question-8" class="section level1">
<h1>Question 8</h1>
<div id="categorize-ales" class="section level2">
<h2>Categorize Ales…</h2>
<pre class="r"><code># categorize beers as ipa, or other ale (still have orig columns as well as infilled)
beers_categorized &lt;- merged %&gt;%
  mutate(is_ipa = grepl(&quot;\\bIPA\\b&quot;,Style,ignore.case = TRUE)) %&gt;%
  mutate(is_ale = grepl(&quot;\\bale\\b&quot;,Style,ignore.case = TRUE)) %&gt;%
  mutate(is_american = grepl(&quot;\\bamerican\\b&quot;,Style,ignore.case = TRUE)) %&gt;%
  mutate(is_belgian = grepl(&quot;\\bbelgian\\b&quot;,Style,ignore.case = TRUE)) %&gt;%
  mutate(is_other_ale = (is_ale &amp; !is_ipa)) 

# keep only the ales
only_ales &lt;- beers_categorized %&gt;% filter(is_ipa | is_other_ale)

# and make a factor for the type
# here I replace orig columns with infilled columns.
infill_normalized &lt;- only_ales %&gt;% 
  filter(is_ipa | is_other_ale) %&gt;%
  mutate(category = as.factor(ifelse(is_ipa,&#39;IPA&#39;,&#39;Other&#39;))) %&gt;%
  select(-IBU,-ABV) %&gt;%
  rename(IBU=IBUfill,ABV=ABVfill) %&gt;%
  mutate(abv_z = scale(ABV), ibu_z = scale(IBU)) %&gt;%
  select(ABV,IBU,abv_z,ibu_z,category)

# synthetic data, for looking at predictions &#39;everywhere&#39;
dummy &lt;- data.frame(ABV=rep(0,100*100),IBU=rep(0,100*100))
ABV &lt;- linspace(min(infill_normalized$ABV),max(infill_normalized$ABV),100)
IBU &lt;- linspace(min(infill_normalized$IBU),max(infill_normalized$IBU),100)
cnt &lt;- 0
for (i in 1:100)
{
  for (j in 1:100)
  {
    cnt &lt;- cnt + 1
    dummy[cnt,] &lt;- c(ABV[i],IBU[j])
  }
}
synth &lt;- dummy %&gt;% mutate(abv_z = scale(ABV), ibu_z = scale(IBU))

# here I leave orig columns alone, but drop observations with missing values.
for_orig_plot &lt;- only_ales %&gt;% 
  filter(is_ipa | is_other_ale) %&gt;%
  mutate(category = as.factor(ifelse(is_ipa,&#39;IPA&#39;,&#39;Other&#39;))) %&gt;%
  drop_na(ABV,IBU)

# columns to use for predictors
cols_for_knn = c(&quot;abv_z&quot;,&quot;ibu_z&quot;)                                                

# counts
total_count &lt;- nrow(beers_raw)
ipa_count &lt;- only_ales %&gt;% filter(is_ipa) %&gt;% nrow()
other_count &lt;- only_ales %&gt;% filter(is_other_ale) %&gt;% nrow()
ale_count &lt;- ipa_count + other_count

ale_percent   &lt;- round(100 * ale_count / total_count)
ipa_percent   &lt;- round(100 * ipa_count / total_count)
other_percent &lt;- round(100 * other_count / total_count)
ipa_percent_of_ales &lt;- round(100 * ipa_count / ale_count)
other_percent_of_ales &lt;- round(100 * other_count / ale_count)</code></pre>
<p>Out of a total of 2410 beers, 571 are IPA and 963 are other ales.</p>
<p>64 % of beers are ales.</p>
<p>24 % of beers are IPA.</p>
<p>37 % of ales are IPA.</p>
</div>
<div id="make-a-scatter-plot-of-ibu-vs-abv-with-only-ipas-and-other-ales" class="section level2">
<h2>Make a scatter plot of IBU vs ABV, with only IPA’s and other ales</h2>
<pre class="r"><code>for_orig_plot %&gt;% ggplot(aes(x=IBU,y=ABV,color=category)) + 
  geom_point() + ggtitle(&#39;ABV vs IBU for IPAs and other ales (missing values dropped)&#39;) +
  coord_cartesian(ylim = c(0.02,0.1),xlim=c(0,150)) +
  scale_color_manual(breaks = c(&quot;IPA&quot;, &quot;Other&quot;),
                        values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="make-the-same-scatter-plot-but-using-infilled-data." class="section level2">
<h2>Make the same scatter plot, but using infilled data.</h2>
<pre class="r"><code>infill_normalized %&gt;% ggplot(aes(x=IBU,y=ABV,color=category)) + 
  geom_point() + ggtitle(&#39;ABV vs IBU for IPAs and other ales (infilled)&#39;) +
  coord_cartesian(ylim = c(0.02,0.1),xlim=c(0,150)) +
  scale_color_manual(breaks = c(&quot;IPA&quot;, &quot;Other&quot;),
                        values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>From these scatter plots, it appears that the character of the relationship between ABV and IBU, for both IPA’s and other ales, is unaffected by the infilling. This gives us confidence that the infilling was valid, so further analysis will use only the infilled values.</p>
<p>We know that 37 % of ales are IPA, so a fixed guess that any given Ale is not IPA is the simplest model. We expect this predictor will have an accuracy of 63 %. It would have a sensitivity of 100 % but specificity of 0 %.</p>
</div>
<div id="make-a-constant-classifier-and-check-its-performance." class="section level2">
<h2>Make a constant classifier and check its performance.</h2>
<pre class="r"><code>size = nrow(infill_normalized)
always_ipa &lt;- data.frame(sample(x=as.factor(c(&#39;IPA&#39;,&#39;Other&#39;)),size,replace=TRUE,prob=c(0,1)))
colnames(always_ipa) &lt;- c(&#39;guess&#39;)
CM_always &lt;- confusionMatrix(always_ipa$guess,infill_normalized$category,positive=positive_value)
always_acc &lt;- CM_always$overall[1] # accuracy
always_sens &lt;- CM_always$byClass[1] # sensitivity
always_spec &lt;- CM_always$byClass[2] # specificity</code></pre>
<p>The accuracy turns out to be 63 %.</p>
<p>The sensitivity is 100 %.</p>
<p>The specificity is 0 %.</p>
</div>
<div id="make-a-random-guess-classifier-and-check-its-performance" class="section level2">
<h2>Make a random guess classifier and check its performance</h2>
<p>A slightly more sophisticated model would be to randomly guess that a beer is an ale 63 % of the time. We simulate this to see how such a ‘guessing’ model would perform.</p>
<p>Try it 100 times and find its average performance.</p>
<pre class="r"><code>acc_guess &lt;- matrix(nrow=iterations,ncol=3)
size = nrow(infill_normalized)
for (j in 1:iterations) 
{
  guess &lt;- data.frame(sample(x=as.factor(c(&#39;IPA&#39;,&#39;Other&#39;)),size,replace=TRUE,prob=c(ipa_count,other_count)))
  colnames(guess) &lt;- c(&#39;guess&#39;)
  CM_guess &lt;- confusionMatrix(guess$guess,infill_normalized$category,positive=positive_value)
  acc_guess[j,1] &lt;- CM_guess$overall[1] # accuracy
  acc_guess[j,2] &lt;- CM_guess$byClass[1] # sensitivity
  acc_guess[j,3] &lt;- CM_guess$byClass[2] # specificity
}
mean_stats &lt;- colMeans(acc_guess)
mean_accuracy    &lt;- mean_stats[1]
mean_sensitivity &lt;- mean_stats[2]
mean_specificity &lt;- mean_stats[3]

guess_acc &lt;- mean_stats[1]
guess_sens &lt;- mean_stats[2]
guess_spec &lt;- mean_stats[3]</code></pre>
<p>The random guess model has accuracy of 53 %.</p>
<p>Its sensitivity is 63 %.</p>
<p>Its specificity is 37 %.</p>
</div>
<div id="look-at-distributions-of-abv-and-ibu" class="section level2">
<h2>Look at distributions of ABV and IBU</h2>
<p>To see if ABV and IBU values can help us predict if an ale is IPA or not, first look at distributions of these quantities, separated by IPA or other ale.</p>
<pre class="r"><code>infill_normalized %&gt;% ggplot(aes(x=ABV)) +
  geom_histogram(aes(color=category,fill=category),
                 position=&quot;identity&quot;,alpha=0.4,
                 show.legend = TRUE,bins=21) +
  ggtitle(&#39;histogram of ABV by category (infilled)&#39;) +
  scale_color_manual(values=q8_colors) +
  scale_fill_manual(values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<pre class="r"><code>infill_normalized %&gt;% ggplot(aes(x=IBU)) +
  geom_histogram(aes(color=category,fill=category),
                 position=&quot;identity&quot;,alpha=0.4,
                 show.legend = TRUE,bins=21) +
  ggtitle(&#39;histogram of IBU by category (infilled)&#39;) +
  scale_color_manual(values=q8_colors) +
  scale_fill_manual(values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>There appears to be clear separation of both ABV and IBU between IPA’s and other ales. Since the distributions appear close to normal, and similiar in shape for the two types of ale, we proceed with t-tests to determine if there is a statistically significant difference.</p>
<pre class="r"><code>ibu_ttest &lt;- t.test(IBU ~ category,infill_normalized,var.equal=FALSE)
ibu_ttest</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  IBU by category
## t = 40.367, df = 1117.4, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  35.43793 39.05898
## sample estimates:
##   mean in group IPA mean in group Other 
##            71.19796            33.94950</code></pre>
<pre class="r"><code>abv_ttest &lt;- t.test(ABV ~ category,infill_normalized,var.equal=FALSE)
abv_ttest</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  ABV by category
## t = 19.173, df = 1100.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  0.01082080 0.01328807
## sample estimates:
##   mean in group IPA mean in group Other 
##          0.06880210          0.05674766</code></pre>
<p>Check statistically significant difference in ABV and IBU between IPA’s and other ales.</p>
<pre class="r"><code>abv_col &lt;- c(abv_ttest$estimate[2],
             abv_ttest$estimate[1])
ibu_col &lt;- c(ibu_ttest$estimate[2],
             ibu_ttest$estimate[1])
hypothesis &lt;- data.frame(abv_col,ibu_col)
colnames(hypothesis) &lt;- c(&#39;ABV(%)&#39;,&#39;IBU(Intl Bitterness Units)&#39;)
rownames(hypothesis) &lt;- c(&#39;IPA&#39;,&#39;Other Ales&#39;)
kable(hypothesis,digits=4,caption = &#39;Difference in characteristics between IPAs and other Ales&#39;) %&gt;%
  kable_styling(bootstrap_options = c(&#39;striped&#39;))</code></pre>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
Difference in characteristics between IPAs and other Ales
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
ABV(%)
</th>
<th style="text-align:right;">
IBU(Intl Bitterness Units)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
IPA
</td>
<td style="text-align:right;">
0.0567
</td>
<td style="text-align:right;">
33.9495
</td>
</tr>
<tr>
<td style="text-align:left;">
Other Ales
</td>
<td style="text-align:right;">
0.0688
</td>
<td style="text-align:right;">
71.1980
</td>
</tr>
</tbody>
</table>
<p>Statistical Significance</p>
<pre class="r"><code>abv_col &lt;- c(format(abv_ttest$p.value,digits=4),
             paste(format(abv_ttest$conf.int[1],digits=3),format(abv_ttest$conf.int[2],digits=4),sep=&quot; .. &quot;))
ibu_col &lt;- c(format(ibu_ttest$p.value,digits=4),
             paste(format(ibu_ttest$conf.int[1],digits=3),format(ibu_ttest$conf.int[2],digits=1),sep=&quot; .. &quot;))
stat_sig &lt;- data.frame(abv_col,ibu_col)
colnames(stat_sig) &lt;- c(&#39;ABV&#39;,&#39;IBU&#39;)
rownames(stat_sig) &lt;- c(&#39;p-value&#39;,&#39;95% conf int&#39;)
kable(stat_sig,caption = &#39;Statistical significance from Welch t-test&#39;) %&gt;%
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
Statistical significance from Welch t-test
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
ABV
</th>
<th style="text-align:left;">
IBU
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
p-value
</td>
<td style="text-align:left;">
6.388e-71
</td>
<td style="text-align:left;">
1.773e-220
</td>
</tr>
<tr>
<td style="text-align:left;">
95% conf int
</td>
<td style="text-align:left;">
0.0108 .. 0.01329
</td>
<td style="text-align:left;">
35.4 .. 39
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-a-naive-bayes-classifier" class="section level2">
<h2>Create a Naive Bayes Classifier</h2>
<p>Since there are statistically signficant differences with ABV and IBU, we first try a Naive Bayes classifier.</p>
<pre class="r"><code>pred_indices &lt;- c(&quot;ABV&quot;,&quot;IBU&quot;)
acc_nb = matrix(nrow=iterations,ncol=3)
# for repeatability
set.seed(42)
for (j in 1:iterations)
{
  trainIndices = sample(seq(1:length(infill_normalized$ABV)),
                        round(.7*length(infill_normalized$ABV)))
  trainBeer = infill_normalized[trainIndices,]
  testBeer = infill_normalized[-trainIndices,]
  model_nb &lt;- naiveBayes(trainBeer[,pred_indices],trainBeer$category)
  CM_nb &lt;- confusionMatrix(table(predict(model_nb,testBeer[,pred_indices]),
                                as.factor(testBeer$category)),positive=positive_value)
                          
  acc_nb[j,1] &lt;- CM_nb$overall[1] # accuracy
  acc_nb[j,2] &lt;- CM_nb$byClass[1] # sensitivity
  acc_nb[j,3] &lt;- CM_nb$byClass[2] # specificity
}
mean_stats &lt;- colMeans(acc_nb)
nb_acc &lt;- mean_stats[1]
nb_sens &lt;- mean_stats[2]
nb_spec &lt;- mean_stats[3]</code></pre>
<p>Averaging over 100 trials, the Naive Bayes classifier has</p>
<p>accuracy of 86 %</p>
<p>sensitivity of 89 %</p>
<p>specificity of 81 %</p>
<p>To understand the classification regions of the Naieve Bayes classifier, we make a prediction at every point in the ABV vs IBU space.</p>
<pre class="r"><code>beer_nb &lt;- naiveBayes(infill_normalized[,pred_indices],infill_normalized$category)
nb_predict &lt;- predict(beer_nb, synth)
synth_w_nbpred &lt;- cbind(synth,nb_predict)
synth_w_nbpred %&gt;% ggplot(aes(x=IBU,y=ABV,color=nb_predict)) + geom_point() +
  ggtitle(&#39;Class Map from Naive Bayes&#39;) +
  scale_color_manual(breaks = c(&quot;IPA&quot;, &quot;Other&quot;),values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>The Naive Bayes classifier draws a clear boundary betweeen two regions. Ales with high ABV and IBU are predicted to be IPA.</p>
<p>However, this does not well capture the relationship that is apparent in the scatter plot of ABV vs IBU for IPA’s and other ales. To better use this information, we use a KNN classifier, labeling an ale as IPA or not according to the majority of its nearest neighbors. To tune the KNN model, we try several different neighborhood sizes (k).</p>
</div>
<div id="create-a-knn-classifer" class="section level2">
<h2>Create a KNN Classifer</h2>
<p>Make 100 iterations of the model, splitting the data into training and test datasets each time and averaging the performance statistics of the model. Do this for a number of different k values.</p>
<pre class="r"><code># for repeatability
set.seed(42)
splitPerc &lt;- .7
numks &lt;- 50
knn_stats = matrix(nrow=numks,ncol=4)
for (i in 1:numks)
{
  acc  = matrix(nrow=iterations,ncol=1)
  sens = matrix(nrow=iterations,ncol=1)
  spec = matrix(nrow=iterations,ncol=1)
  for (j in 1:iterations)
  {
    trainIndices = sample(1:dim(infill_normalized)[1],round(splitPerc * dim(infill_normalized)[1]))
    train = infill_normalized[trainIndices,]
    test = infill_normalized[-trainIndices,]
    classifications = knn(train[,cols_for_knn],
                              test[,cols_for_knn],
                              as.factor(train$category), prob = TRUE, k = i)
    CM = confusionMatrix(table(as.factor(test$category),classifications),positive=positive_value)
    acc[j]  = CM$overall[1]
    sens[j] = CM$byClass[1]
    spec[j] = CM$byClass[2]
  }
  knn_stats[i,1] = i
  knn_stats[i,2] = colMeans(acc)
  knn_stats[i,3] = colMeans(sens)
  knn_stats[i,4] = colMeans(spec)
}</code></pre>
<p>Look at all 50 values of k to determine what k value gives best performance.</p>
<pre class="r"><code>stats_frame &lt;- data.frame(knn_stats)
colnames(stats_frame) &lt;- c(&quot;k&quot;,&quot;accuracy&quot;,&quot;sensitivity&quot;,&quot;specificity&quot;)
for_plot &lt;- reshape2::melt(stats_frame,id.var=&#39;k&#39;)
for_plot %&gt;% ggplot(aes(x=k,y=value,col=variable)) + 
  geom_line() +
  xlab(&#39;k&#39;) +
  ylab(&#39;percent&#39;) +
  ggtitle(&#39;Performance of Classifier by K&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<pre class="r"><code>combined_stats &lt;- stats_frame %&gt;% 
  mutate(sums = accuracy + sensitivity + specificity) 

best_k_acc  &lt;- which.max(combined_stats$accuracy)
best_k_sens &lt;- which.max(combined_stats$sensitivity)
best_k_spec &lt;- which.max(combined_stats$specificity)
best_k_combined &lt;- which.max(combined_stats$sums)

chosen_k = best_k_combined

best_acc &lt;-  round(100*combined_stats$accuracy[chosen_k])
best_sens &lt;- round(100*combined_stats$sensitivity[chosen_k])
best_spec &lt;- round(100*combined_stats$specificity[chosen_k])</code></pre>
<p>k of 14 is best for accuracy.</p>
<p>k of 43 is best for sensitivity. k of 13 is best for specificity.</p>
<p>we choose 14 as best overall, since it gives the highest sum of accuracy, sensitivity, and specificity.</p>
<p>As with the Naive Bayes classifier, to understand the classification regions of the KNN classifier, we make a prediction at every point in the ABV vs IBU space.</p>
<pre class="r"><code>plot_title &lt;- paste(&#39;Class map from knn with k of&#39;,as.character(chosen_k))
synth_pred_knn &lt;- knn(infill_normalized[,cols_for_knn],
                  synth[,cols_for_knn],
                  as.factor(infill_normalized$category),k=chosen_k)
synth_w_knnpred &lt;- cbind(synth,synth_pred_knn)
synth_w_knnpred %&gt;% ggplot(aes(x=IBU,y=ABV,color=synth_pred_knn)) + geom_point() + ggtitle(plot_title) +
  scale_color_manual(breaks = c(&quot;IPA&quot;, &quot;Other&quot;),values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>This model does capture more of the detailed relationship between ABV and IBU for IPA’s and other ales.</p>
<p>Finally, go back and make predictions of all points in the original dataset.</p>
<pre class="r"><code>knn_pred &lt;- knn(infill_normalized[,cols_for_knn],
                infill_normalized[,cols_for_knn],
                as.factor(infill_normalized$category),k=chosen_k)
with_pred &lt;- cbind(infill_normalized,knn_pred)
with_pred %&gt;% ggplot(aes(x=IBU,y=ABV,color=knn_pred)) + geom_point() + ggtitle(&#39;Predicted Class&#39;) +
  scale_color_manual(breaks = c(&quot;IPA&quot;, &quot;Other&quot;),
                        values=q8_colors)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<pre class="r"><code>CM_knn = confusionMatrix(table(as.factor(infill_normalized$category),knn_pred),positive=positive_value)
knn_acc &lt;- CM_knn$overall[1] # accuracy
knn_sens &lt;- CM_knn$byClass[1] # sensitivity
knn_spec &lt;- CM_knn$byClass[2] # specificity</code></pre>
<p>KNN accuracy turns out to be 89 %.</p>
<p>KNN sensitivity is 92 %.</p>
<p>KNN specificity is 85 %.</p>
</div>
<div id="summarizing-performance-of-classification-models" class="section level2">
<h2>Summarizing performance of classification models…</h2>
<pre class="r"><code>always_perf &lt;- 100 * c(always_sens,always_spec,always_acc)
guess_perf &lt;-  100 * c(guess_sens,guess_spec,guess_acc)
nb_perf &lt;-     100 * c(nb_sens,nb_spec,nb_acc)
knn_perf &lt;-    100 * c(knn_sens,knn_spec,knn_acc)

performance &lt;- data.frame(always_perf, guess_perf, nb_perf, knn_perf)
colnames(performance) &lt;- c(&#39;Constant&#39;,&#39;Random&#39;,&#39;Naive Bayes&#39;,&#39;KNN&#39;)
rownames(performance) &lt;- c(&#39;Sensitivity&#39;,&#39;Specificity&#39;,&#39;Overall Accuracy&#39;)

kable(performance,digits=2,caption = &#39;Performance (in percent) of models with increasing sophistication&#39;) %&gt;%
  kable_styling(bootstrap_options = c(&#39;striped&#39;))</code></pre>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
Performance (in percent) of models with increasing sophistication
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Constant
</th>
<th style="text-align:right;">
Random
</th>
<th style="text-align:right;">
Naive Bayes
</th>
<th style="text-align:right;">
KNN
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sensitivity
</td>
<td style="text-align:right;">
100.00
</td>
<td style="text-align:right;">
62.84
</td>
<td style="text-align:right;">
88.77
</td>
<td style="text-align:right;">
91.53
</td>
</tr>
<tr>
<td style="text-align:left;">
Specificity
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
37.43
</td>
<td style="text-align:right;">
81.05
</td>
<td style="text-align:right;">
84.78
</td>
</tr>
<tr>
<td style="text-align:left;">
Overall Accuracy
</td>
<td style="text-align:right;">
62.78
</td>
<td style="text-align:right;">
53.38
</td>
<td style="text-align:right;">
85.87
</td>
<td style="text-align:right;">
88.98
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="question-9" class="section level1">
<h1>Question 9</h1>
<p>Knocking their socks off: 1. find the most popular beers in each state 2. find the states that have lower than median breweries per capita 3. find states with &gt; 5M total population 5. run k-means clustering to group selected states by beer features</p>
</div>
<div id="data-prep" class="section level1">
<h1>Data prep:</h1>
<pre class="r"><code>#cleaning house:
merged$State &lt;- str_trim(merged$State, &quot;left&quot;)

# basic EDA
# style_count &lt;- merged %&gt;% group_by(Style) %&gt;% summarize(n = n()) %&gt;% arrange(desc(n))
# style_count %&gt;% filter(n &gt; 50) %&gt;% ggplot(aes(x=reorder(Style, desc(n)), y = n)) +
#   geom_bar(stat=&quot;identity&quot;, fill = &quot;#C8102E&quot;) +
#   theme(axis.text.x = element_text(angle = 45, hjust=1)) +
#   labs(title=&quot;10 Most Common Styles of Craft Brews&quot;, x=&quot;&quot;, y=&quot;Count&quot;)

# get the 1st, 2nd, and 3rd most popular beers per state
stateabbr &lt;- unique(merged$State)
popular1 &lt;- c()
popular2 &lt;- c()
popular3 &lt;- c()
for (i in 1:length(stateabbr))
{
  temp &lt;- merged %&gt;% 
    filter(State==stateabbr[i]) %&gt;% 
    group_by(Style) %&gt;% 
    summarize(n=n()) %&gt;% 
    arrange(desc(n))
  
  popular1[i] &lt;- as.character(temp$Style)[1]
  popular2[i] &lt;- as.character(temp$Style)[2]
  popular3[i] &lt;- as.character(temp$Style)[3]
}

q9 &lt;- data.frame(State = stateabbr, P1 = popular1, P2 = popular2, P3 = popular3)

style_count_bystate &lt;- merged %&gt;% group_by(State) %&gt;% summarize(nStyles = n_distinct(Style))
q9 &lt;- merge(q9, style_count_bystate, by=&quot;State&quot;)

tempbrewery &lt;- breweries_raw %&gt;%  group_by(State) %&gt;% summarize(breweryCount = n())
q9$breweryCount &lt;- tempbrewery$breweryCount

temp &lt;- statepop
temp$State &lt;- temp$abbr
q9 &lt;- merge(q9,temp, by=&quot;State&quot;)

q9$nBreweriesPerCapita = q9$breweryCount/(q9$pop_2015/1000000)

# which states have populations &gt; 5,000,000
q9$gt5M &lt;- &quot;lt5M&quot;
q9$gt5M[which(q9$pop_2015 &gt; 5000000)] = &quot;gt5M&quot;

# which states have below average breweries per Capita
q9$belowperCapita &lt;- &quot;gtMedian&quot;
q9$belowperCapita[which(q9$nBreweriesPerCapita &lt; median(q9$nBreweriesPerCapita, na.rm=TRUE))] = &quot;ltMedian&quot;

# q9$state &lt;- states_and_dc$state

q9$target &lt;- &quot;no&quot;
q9$target[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)] = &quot;yes&quot;

# state land area in square miles
temp &lt;- data.frame(State = state.abb, LandArea = state.area)
q9 &lt;- merge(q9,temp, by=&quot;State&quot;)

q9$nStylesPerCapita &lt;- q9$nStyles/(q9$pop_2015/1000000)
q9$PopulationPerSqMile &lt;- q9$pop_2015/q9$LandArea
q9$nBreweriesPerSqMile &lt;- q9$breweryCount/(q9$LandArea/1000)

# intersection of population and breweries per capita
q9$popular1st &lt;- &quot;N/A&quot;
q9$popular1st[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)] = 
  as.character(q9$P1[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)])

q9$popular2nd &lt;- &quot;N/A&quot;
q9$popular2nd[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)] = 
  as.character(q9$P2[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)])

q9$popular3rd &lt;- &quot;N/A&quot;
q9$popular3rd[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)] = 
  as.character(q9$P3[which(q9$gt5M == &quot;gt5M&quot; &amp; q9$belowperCapita == &quot;ltMedian&quot;)])</code></pre>
</div>
<div id="mapping-states-with-population-5m" class="section level1">
<h1>Mapping states with population &gt; 5M:</h1>
<pre class="r"><code>plot_usmap(regions = c(&quot;states&quot;), data = q9,
  values = &quot;gt5M&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) + 
  theme(legend.position=&quot;right&quot;) +
  scale_fill_manual(name = &quot;pop.&quot;, values=c(&quot;#b1b3b3&quot;,&quot;white&quot;), labels = c(&quot;&gt;5M&quot;,&quot;&lt;5M&quot;)) +
  labs(title = &#39;States with Population of 5M or greater&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
</div>
<div id="mapping-states-with-less-than-median-number-of-breweries-per-capita" class="section level1">
<h1>Mapping states with less than median number of breweries per capita:</h1>
<pre class="r"><code>plot_usmap(regions = c(&quot;states&quot;), data = q9,
  values = &quot;belowperCapita&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) + 
  theme(legend.position=&quot;right&quot;) +
  scale_fill_manual(name = &quot;&quot;, values=c(&quot;white&quot;,&quot;#13294B&quot;), labels = c(&quot;&gt;Median&quot;,&quot;&lt;Median&quot;)) +
  labs(title = &#39;States with lower than median Breweries per Capita&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
</div>
<div id="states-to-target" class="section level1">
<h1>States to Target:</h1>
<pre class="r"><code>plot_usmap(regions = c(&quot;states&quot;), data = q9,
  values = &quot;target&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) + 
  theme(legend.position=&quot;right&quot;) +
  scale_fill_manual(name = &quot;&quot;, values=c(&quot;white&quot;,&quot;#C8102E&quot;)) +
  labs(title = &#39;States to Target&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="k-means-clustering-of-target-states-httpsuc-r.github.iokmeans_clustering" class="section level1">
<h1>K-Means Clustering of Target States (<a href="https://uc-r.github.io/kmeans_clustering" class="uri">https://uc-r.github.io/kmeans_clustering</a>)</h1>
<p>Data prep:</p>
<pre class="r"><code>merged$ratio &lt;- merged$IBU/merged$ABV

ia_ratio &lt;- merged %&gt;%
  group_by(State) %&gt;%
  summarize(ia_ratio = median(ratio, na.rm=TRUE))
medianabv &lt;- merged %&gt;%
  group_by(State) %&gt;%
  summarize(medianabv = median(ABV, na.rm=TRUE))
medianibu &lt;- merged %&gt;%
  group_by(State) %&gt;%
  summarize(medianibu = median(IBU, na.rm=TRUE))

m1 &lt;- merge(ia_ratio, medianabv, by=&quot;State&quot;)
m2 &lt;- merge(m1, medianibu, by=&quot;State&quot;)
q9 &lt;- merge(q9, m2, by=&quot;State&quot;)

nBreweries &lt;- merged %&gt;%
  group_by(State) %&gt;%
  summarize(nBreweries = length(unique(as.character(Brewery_name))))

q9 &lt;- merge(q9,nBreweries, by=&quot;State&quot;)
q9$nStylesPerBrewery &lt;- q9$nStyles/q9$nBreweries


forkmeans &lt;- q9 %&gt;% select(medianabv, medianibu, ia_ratio, nBreweriesPerCapita)

# https://www.rdocumentation.org/packages/BBmisc/versions/1.10/topics/normalize
# library(BBmisc)
forkmeans_s &lt;- normalize(forkmeans, method = &quot;standardize&quot;)

row.names(forkmeans_s) &lt;- q9$State
row.names(forkmeans) &lt;- q9$State

forkmeans_s$target &lt;- NA
forkmeans$target &lt;- NA
forkmeans_s$target[which(q9$target == &quot;yes&quot;)] = 1
forkmeans$target[which(q9$target == &quot;yes&quot;)] = 1

forkmeans &lt;- na.omit(forkmeans)
forkmeans_s &lt;- na.omit(forkmeans_s)

forkmeans$target &lt;- NULL
forkmeans_s$target &lt;- NULL</code></pre>
</div>
<div id="find-optimal-value-for-k" class="section level1">
<h1>Find optimal value for “k”:</h1>
<pre class="r"><code># library(factoextra)
fviz_nbclust(forkmeans_s, kmeans, method=&quot;wss&quot;, linecolor = &quot;#13294B&quot;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="fit-model" class="section level1">
<h1>Fit model:</h1>
<pre class="r"><code>set.seed(10)
brewsCluster &lt;- kmeans(forkmeans_s, 4, nstart=20)
str(brewsCluster)</code></pre>
<pre><code>## List of 9
##  $ cluster     : Named int [1:11] 2 4 4 1 1 1 3 4 2 2 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:11] &quot;CA&quot; &quot;FL&quot; &quot;GA&quot; &quot;IL&quot; ...
##  $ centers     : num [1:4, 1:4] 0.00722 0.46833 -2.33846 -0.01283 -0.76556 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:4] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot;
##   .. ..$ : chr [1:4] &quot;medianabv&quot; &quot;medianibu&quot; &quot;ia_ratio&quot; &quot;nBreweriesPerCapita&quot;
##  $ totss       : num 25
##  $ withinss    : num [1:4] 2.148 0.208 0 0.806
##  $ tot.withinss: num 3.16
##  $ betweenss   : num 21.9
##  $ size        : int [1:4] 4 3 1 3
##  $ iter        : int 1
##  $ ifault      : int 0
##  - attr(*, &quot;class&quot;)= chr &quot;kmeans&quot;</code></pre>
<pre class="r"><code>brewsCluster$cluster</code></pre>
<pre><code>## CA FL GA IL MD MO NJ NY OH TN TX 
##  2  4  4  1  1  1  3  4  2  2  1</code></pre>
<pre class="r"><code>cluster_container = c()
for (i in 1:length(brewsCluster$cluster))
{
  cluster_container[i] &lt;- brewsCluster$cluster[[i]]
}</code></pre>
</div>
<div id="visualize-model-output---clusters-by-the-first-two-principle-components" class="section level1">
<h1>Visualize model output - clusters by the first two principle components:</h1>
<pre class="r"><code>fviz_cluster(brewsCluster, forkmeans_s, labelsize = 12, 
             repel=TRUE, show.clust.cent = FALSE, ellipse.alpha = 0.6) +
  scale_color_manual(values = c(&quot;#C8102E&quot;, &quot;#13294B&quot;, &quot;darkgreen&quot;, &quot;#b1b3b3&quot;)) +
  scale_fill_manual(values = c(&quot;#C8102E&quot;, &quot;#13294B&quot;, &quot;darkgreen&quot;, &quot;#b1b3b3&quot;))</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
</div>
<div id="prep-data-for-visualization" class="section level1">
<h1>Prep data for visualization:</h1>
<pre class="r"><code>forkmeans_tomap &lt;- forkmeans
forkmeans_tomap$cluster &lt;- cluster_container
# forkmeans_tomap$fips &lt;- statesvar
forkmeans_tomap$state &lt;- q9$State[which(q9$target == &quot;yes&quot;)]
forkmeans_tomap$nStylesPerCapita &lt;- q9$nStylesPerCapita[which(q9$target == &quot;yes&quot;)]
forkmeans_tomap$cluster &lt;- as.factor(forkmeans_tomap$cluster)</code></pre>
</div>
<div id="mapping-clusters" class="section level1">
<h1>Mapping clusters:</h1>
<pre class="r"><code>#exclude &lt;- q9$State[which(q9$target == &quot;no&quot;)]
plot_usmap(regions = c(&quot;states&quot;), data = forkmeans_tomap,
  values = &quot;cluster&quot;, theme = theme_map(), labels = FALSE,
  label_color = &quot;black&quot;) +
  theme(legend.position = &quot;right&quot;) +
  guides(fill=guide_legend(title=&quot;cluster&quot;)) +
  scale_fill_manual(labels = c(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;), 
                    values = c(&quot;#C8102E&quot;, &quot;#13294B&quot;, &quot;darkgreen&quot;, &quot;#b1b3b3&quot;)) +
  labs(title=&quot;K-Means Clustering of Target States&quot;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="median-abv-v-median-ibu" class="section level1">
<h1>Median ABV v Median IBU:</h1>
<pre class="r"><code>forkmeans_tomap %&gt;% ggplot(aes(x=medianabv, y=medianibu, col=cluster, fill = cluster, label=row.names(forkmeans_tomap))) +
  geom_text(size=5) +
  geom_label() +
  scale_fill_manual(values = c(&quot;#C8102E&quot;, &quot;#13294B&quot;, &quot;darkgreen&quot;, &quot;#b1b3b3&quot;)) +
  scale_color_manual(values = c(&quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;white&quot;)) +
  labs(title = &quot;Median ABV v Median IBU&quot;, x=&#39;median ABV&#39;, y = &#39;median IBU&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
</div>
<div id="breweries-per-capita-v-ibuabv-ratio" class="section level1">
<h1>Breweries per Capita v IBU:ABV ratio:</h1>
<pre class="r"><code>forkmeans_tomap %&gt;% ggplot(aes(x=nBreweriesPerCapita, y=ia_ratio, 
                               col=cluster, fill = cluster, label=row.names(forkmeans_tomap))) +
  geom_text(size=5) +
  geom_label() +
  scale_fill_manual(values = c(&quot;#C8102E&quot;, &quot;#13294B&quot;, &quot;darkgreen&quot;, &quot;#b1b3b3&quot;)) +
  scale_color_manual(values = c(&quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;white&quot;)) +
  labs(title = &quot;Breweries per Capita v IBU:ABV ratio&quot;, x=&#39;Breweries per Capita (per 1M people)&#39;, y = &#39;IBU:ABV ratio&#39;)</code></pre>
<p><img src="Craft_Beer_Rmarkdown_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
<div id="additional-maps-muted" class="section level1">
<h1>Additional maps (muted):</h1>
<pre class="r"><code># plot_usmap(regions = c(&quot;states&quot;), data = q9,
#   values = &quot;popular1st&quot;, theme = theme_map(), labels = FALSE,
#   label_color = &quot;black&quot;) + 
#   theme(legend.position=&quot;right&quot;) +
#   scale_fill_manual(name = &quot;Style&quot;, values=c(&quot;white&quot;,&quot;red&quot;,&quot;blue&quot;,&quot;darkgray&quot;)) +
#   labs(title = &#39;Most Frequent Beer Style&#39;)
# 
# plot_usmap(regions = c(&quot;states&quot;), data = q9,
#   values = &quot;popular2nd&quot;, theme = theme_map(), labels = FALSE,
#   label_color = &quot;black&quot;) + 
#   theme(legend.position=&quot;right&quot;) +
#   scale_fill_manual(name = &quot;Style&quot;, values=c(&quot;green&quot;,&quot;white&quot;,&quot;red&quot;,&quot;blue&quot;,&quot;darkgray&quot;)) +
#   labs(title = &#39;2nd Most Frequent Beer Style&#39;)
# 
# plot_usmap(regions = c(&quot;states&quot;), data = q9,
#   values = &quot;popular3rd&quot;, theme = theme_map(), labels = FALSE,
#   label_color = &quot;black&quot;) + 
#   theme(legend.position=&quot;right&quot;) +
#   scale_fill_manual(name = &quot;Style&quot;, values=c(&quot;green&quot;,&quot;white&quot;,&quot;red&quot;,&quot;blue&quot;,&quot;navyblue&quot;,&quot;red3&quot;,&quot;grey&quot;,&quot;blue4&quot;,&quot;darkgray&quot;)) +
#   labs(title = &#39;3rd Most Frequent Beer Style&#39;)
# 
# plot_usmap(regions = c(&quot;states&quot;), data = q9,
#   values = &quot;P1&quot;, theme = theme_map(), labels = FALSE,
#   label_color = &quot;black&quot;) + 
#   theme(legend.position=&quot;right&quot;) +
#   scale_fill_manual(name = &quot;Style&quot;, values=c(&quot;green&quot;,&quot;white&quot;,&quot;red&quot;,&quot;blue&quot;,&quot;navyblue&quot;,&quot;red3&quot;,&quot;grey&quot;,&quot;blue4&quot;,&quot;seagreen1&quot;,&quot;darkgray&quot;,&quot;slateblue3&quot;,&quot;yellow2&quot;)) +
#   labs(title = &#39;Most Frequent Beer Style&#39;)</code></pre>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>It is clear that the craft beer segment of the industry has taken hold across the country. There are moderate but clear differences between states in the characteristics of beers.</p>
<p>Examining available measurements of craft beers, we have found statistically significant differences in ABV and IBU between different classes of ales.</p>
<p>Looking at the number of breweries in each state, along with population, we have found eleven states that represent a potentially underserved market. Considering the beers that are currently marketed in those states, we have identified four distinct groups of states with similar tastes. Based on the characteristics of beers that are popular in those states, we believe three new labels with appropriate styles could do well in the underserved market. Here is our recommendation:</p>
<pre class="r"><code>library(knitr)
library(kableExtra)
market &lt;- c(&#39;GA,FL,NY&#39;,&#39;MO,TX,MD,IL,TN,OH,CA&#39;,&#39;NJ&#39;)
style &lt;- c(&#39;IPA&#39;,&#39;Higher Alcohol Ale&#39;,&#39;Lower Alcohol Ale&#39;)
recommendation &lt;- data.frame(market,style)
colnames(recommendation) &lt;- c(&#39;Target Marget&#39;,&#39;Suggested Beer Style&#39;)
kable(recommendation,caption=&#39;Stratety for Underserved Market&#39;) %&gt;%
    kable_styling(bootstrap_options=c(&#39;striped&#39;))</code></pre>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
Stratety for Underserved Market
</caption>
<thead>
<tr>
<th style="text-align:left;">
Target Marget
</th>
<th style="text-align:left;">
Suggested Beer Style
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
GA,FL,NY
</td>
<td style="text-align:left;">
IPA
</td>
</tr>
<tr>
<td style="text-align:left;">
MO,TX,MD,IL,TN,OH,CA
</td>
<td style="text-align:left;">
Higher Alcohol Ale
</td>
</tr>
<tr>
<td style="text-align:left;">
NJ
</td>
<td style="text-align:left;">
Lower Alcohol Ale
</td>
</tr>
</tbody>
</table>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
